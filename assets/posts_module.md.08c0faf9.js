import{_ as s,c as n,o as a,b as l}from"./app.d0d9d5f2.js";const i=JSON.parse(`{"title":"å‰ç«¯æ¨¡å—æœºåˆ¶-ESM&CommonJS","description":"CommonJS ESM","frontmatter":{"title":"å‰ç«¯æ¨¡å—æœºåˆ¶-ESM&CommonJS","description":"CommonJS ESM","aside":false,"date":"2023-5-29","tags":["ESM&CommonJS"]},"headers":[{"level":2,"title":"å‰è¨€","slug":"å‰è¨€","link":"#å‰è¨€","children":[]},{"level":2,"title":"CommonJS äº§ç”Ÿçš„å†å²èƒŒæ™¯","slug":"commonjs-äº§ç”Ÿçš„å†å²èƒŒæ™¯","link":"#commonjs-äº§ç”Ÿçš„å†å²èƒŒæ™¯","children":[]},{"level":2,"title":"å‡ ä¸ª CommonJS ä¾‹å­","slug":"å‡ ä¸ª-commonjs-ä¾‹å­","link":"#å‡ ä¸ª-commonjs-ä¾‹å­","children":[{"level":3,"title":"åœ¨æ¨¡å—å¤–ä¸ºç®€å•ç±»å‹èµ‹å€¼ï¼š","slug":"åœ¨æ¨¡å—å¤–ä¸ºç®€å•ç±»å‹èµ‹å€¼","link":"#åœ¨æ¨¡å—å¤–ä¸ºç®€å•ç±»å‹èµ‹å€¼","children":[]},{"level":3,"title":"åœ¨æ¨¡å—å¤–ä¸ºå¼•ç”¨ç±»å‹èµ‹å€¼ï¼š","slug":"åœ¨æ¨¡å—å¤–ä¸ºå¼•ç”¨ç±»å‹èµ‹å€¼","link":"#åœ¨æ¨¡å—å¤–ä¸ºå¼•ç”¨ç±»å‹èµ‹å€¼","children":[]},{"level":3,"title":"åœ¨æ¨¡å—å†…å¯¼å‡ºåæ”¹å˜ç®€å•ç±»å‹ï¼š","slug":"åœ¨æ¨¡å—å†…å¯¼å‡ºåæ”¹å˜ç®€å•ç±»å‹","link":"#åœ¨æ¨¡å—å†…å¯¼å‡ºåæ”¹å˜ç®€å•ç±»å‹","children":[]},{"level":3,"title":"åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨ module.exports å†å¯¼å‡ºä¸€æ¬¡ï¼š","slug":"åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨-module-exports-å†å¯¼å‡ºä¸€æ¬¡","link":"#åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨-module-exports-å†å¯¼å‡ºä¸€æ¬¡","children":[]},{"level":3,"title":"åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨ exports å†å¯¼å‡ºä¸€æ¬¡ï¼š","slug":"åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨-exports-å†å¯¼å‡ºä¸€æ¬¡","link":"#åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨-exports-å†å¯¼å‡ºä¸€æ¬¡","children":[]}]},{"level":2,"title":"å°è¯•åˆ†æä¸€æ³¢","slug":"å°è¯•åˆ†æä¸€æ³¢","link":"#å°è¯•åˆ†æä¸€æ³¢","children":[]},{"level":2,"title":"CommonJS çš„å…·ä½“å®ç°","slug":"commonjs-çš„å…·ä½“å®ç°","link":"#commonjs-çš„å…·ä½“å®ç°","children":[{"level":3,"title":"require æ–¹æ³•","slug":"require-æ–¹æ³•","link":"#require-æ–¹æ³•","children":[]},{"level":3,"title":"CModule.resolveFilename","slug":"cmodule-resolvefilename","link":"#cmodule-resolvefilename","children":[]},{"level":3,"title":"CModule.prototype.load","slug":"cmodule-prototype-load","link":"#cmodule-prototype-load","children":[]},{"level":3,"title":"åŠ è½½æ–‡ä»¶: CModule.extensions['X']","slug":"åŠ è½½æ–‡ä»¶-cmodule-extensions-x","link":"#åŠ è½½æ–‡ä»¶-cmodule-extensions-x","children":[]},{"level":3,"title":"compile å®ç°","slug":"compile-å®ç°","link":"#compile-å®ç°","children":[]},{"level":3,"title":"æœ€åç”Ÿæˆä¸€ä¸ªå®ä¾‹å¹¶å¯¼å‡º","slug":"æœ€åç”Ÿæˆä¸€ä¸ªå®ä¾‹å¹¶å¯¼å‡º","link":"#æœ€åç”Ÿæˆä¸€ä¸ªå®ä¾‹å¹¶å¯¼å‡º","children":[]},{"level":3,"title":"å®Œæ•´ä»£ç ","slug":"å®Œæ•´ä»£ç ","link":"#å®Œæ•´ä»£ç ","children":[]}]},{"level":2,"title":"æºä»£ç ä¸­çš„ require æ˜¯å¦‚ä½•å®ç°çš„?","slug":"æºä»£ç ä¸­çš„-require-æ˜¯å¦‚ä½•å®ç°çš„","link":"#æºä»£ç ä¸­çš„-require-æ˜¯å¦‚ä½•å®ç°çš„","children":[]},{"level":2,"title":"ç”¨è‡ªå®šä¹‰çš„ CModule æ¥åŠ è½½æ–‡ä»¶","slug":"ç”¨è‡ªå®šä¹‰çš„-cmodule-æ¥åŠ è½½æ–‡ä»¶","link":"#ç”¨è‡ªå®šä¹‰çš„-cmodule-æ¥åŠ è½½æ–‡ä»¶","children":[]},{"level":2,"title":"ç”¨è‡ªå®šä¹‰çš„ CModule æ¥æµ‹è¯•å¾ªç¯å¼•ç”¨","slug":"ç”¨è‡ªå®šä¹‰çš„-cmodule-æ¥æµ‹è¯•å¾ªç¯å¼•ç”¨","link":"#ç”¨è‡ªå®šä¹‰çš„-cmodule-æ¥æµ‹è¯•å¾ªç¯å¼•ç”¨","children":[]},{"level":2,"title":"ä¸ºä»€ä¹ˆ CommonJS ç›¸äº’å¼•ç”¨æ²¡æœ‰äº§ç”Ÿç±»ä¼¼â€œæ­»é”â€çš„é—®é¢˜ï¼Ÿ","slug":"ä¸ºä»€ä¹ˆ-commonjs-ç›¸äº’å¼•ç”¨æ²¡æœ‰äº§ç”Ÿç±»ä¼¼-æ­»é”-çš„é—®é¢˜","link":"#ä¸ºä»€ä¹ˆ-commonjs-ç›¸äº’å¼•ç”¨æ²¡æœ‰äº§ç”Ÿç±»ä¼¼-æ­»é”-çš„é—®é¢˜","children":[]},{"level":2,"title":"JavaScript çš„æ‰§è¡Œè¿‡ç¨‹","slug":"javascript-çš„æ‰§è¡Œè¿‡ç¨‹","link":"#javascript-çš„æ‰§è¡Œè¿‡ç¨‹","children":[{"level":3,"title":"ç¼–è¯‘é˜¶æ®µ","slug":"ç¼–è¯‘é˜¶æ®µ","link":"#ç¼–è¯‘é˜¶æ®µ","children":[]},{"level":3,"title":"æ‰§è¡Œé˜¶æ®µ","slug":"æ‰§è¡Œé˜¶æ®µ","link":"#æ‰§è¡Œé˜¶æ®µ","children":[]}]},{"level":2,"title":"JavaScript çš„å¸¸è§æŠ¥é”™ç±»å‹","slug":"javascript-çš„å¸¸è§æŠ¥é”™ç±»å‹","link":"#javascript-çš„å¸¸è§æŠ¥é”™ç±»å‹","children":[{"level":3,"title":"1ã€RangeError","slug":"_1ã€rangeerror","link":"#_1ã€rangeerror","children":[]},{"level":3,"title":"2ã€ReferenceError","slug":"_2ã€referenceerror","link":"#_2ã€referenceerror","children":[]},{"level":3,"title":"3ã€SyntaxError","slug":"_3ã€syntaxerror","link":"#_3ã€syntaxerror","children":[]},{"level":3,"title":"4ã€TypeError","slug":"_4ã€typeerror","link":"#_4ã€typeerror","children":[]}]},{"level":2,"title":"ä»€ä¹ˆå« ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£? ä»€ä¹ˆå« è¿è¡Œæ—¶åŠ è½½?","slug":"ä»€ä¹ˆå«-ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£-ä»€ä¹ˆå«-è¿è¡Œæ—¶åŠ è½½","link":"#ä»€ä¹ˆå«-ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£-ä»€ä¹ˆå«-è¿è¡Œæ—¶åŠ è½½","children":[]},{"level":2,"title":"ESM çš„åŠ è½½ç»†èŠ‚","slug":"esm-çš„åŠ è½½ç»†èŠ‚","link":"#esm-çš„åŠ è½½ç»†èŠ‚","children":[]},{"level":2,"title":"å†è°ˆ ESM å’Œ CommonJS çš„åŒºåˆ«","slug":"å†è°ˆ-esm-å’Œ-commonjs-çš„åŒºåˆ«","link":"#å†è°ˆ-esm-å’Œ-commonjs-çš„åŒºåˆ«","children":[]}],"relativePath":"posts/module.md"}`),p={name:"posts/module.md"},o=l(`<h2 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a></h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ ESM å’Œ CommonJS æ¨¡å—æœ‰ä¸€äº›å·®å¼‚ï¼š</p><ul><li>CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒESM æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ã€‚</li><li>CommonJS æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒESM æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ã€‚</li></ul><p>è¿™é‡Œæˆ‘ä»¬å¯èƒ½ä¼šæå‡ºç–‘é—® ğŸ¤”ï¸ï¼š</p><ul><li><p>ä¸ºä»€ä¹ˆ CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼Ÿå…¶å…·ä½“ç»†èŠ‚æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ</p></li><li><p>ä»€ä¹ˆå« è¿è¡Œæ—¶åŠ è½½?</p></li><li><p>ä»€ä¹ˆå« ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ï¼Ÿ</p></li><li><p>ä¸ºä»€ä¹ˆ ES6 æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ï¼Ÿ</p></li></ul><h2 id="commonjs-äº§ç”Ÿçš„å†å²èƒŒæ™¯" tabindex="-1">CommonJS äº§ç”Ÿçš„å†å²èƒŒæ™¯ <a class="header-anchor" href="#commonjs-äº§ç”Ÿçš„å†å²èƒŒæ™¯" aria-hidden="true">#</a></h2><p>CommonJS ç”± Mozilla å·¥ç¨‹å¸ˆ Kevin Dangoor äº 2009 å¹´ 1 æœˆåˆ›ç«‹ï¼Œæœ€åˆå‘½åä¸º ServerJSã€‚2009 å¹´ 8 æœˆï¼Œè¯¥é¡¹ç›®æ›´åä¸º CommonJSã€‚æ—¨åœ¨è§£å†³ Javascript ä¸­ç¼ºå°‘æ¨¡å—åŒ–æ ‡å‡†çš„é—®é¢˜ã€‚</p><p>Node.js åæ¥ä¹Ÿé‡‡ç”¨äº† CommonJS çš„æ¨¡å—è§„èŒƒã€‚</p><p>ç”±äº CommonJS å¹¶ä¸æ˜¯ ECMAScript æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ ç±»ä¼¼ module å’Œ require å¹¶ä¸æ˜¯ JS çš„å…³é”®å­—ï¼Œä»…ä»…æ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°è€Œå·²ï¼Œæ„è¯†åˆ°è¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨æ‰“å° moduleã€require æŸ¥çœ‹ç»†èŠ‚ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">module</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(require)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// out:</span></span>
<span class="line"><span style="color:#A6ACCD;">Module </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">filename</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS/c.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">loaded</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">children</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">paths</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/xxx/Desktop/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/xxx/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/node_modules</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">[Function: require] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">resolve</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">Function</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">resolve</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">paths</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">Function</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">paths</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">main</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">filename</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS/c.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">loaded</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">children</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">paths</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/xxx/Desktop/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/xxx/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/node_modules</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    ]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">extensions</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prototype</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#82AAFF;">Function</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">anonymous</span><span style="color:#F07178;">)]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#82AAFF;">Function</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">anonymous</span><span style="color:#F07178;">)]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.node</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: [</span><span style="color:#82AAFF;">Function</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">anonymous</span><span style="color:#F07178;">)]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">cache</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prototype</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS/c.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">filename</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/commonJS/c.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">loaded</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">children</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">paths</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">Array</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ° module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ require æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»…æ­¤è€Œå·²ã€‚</p><p>æˆ‘ä»¬æ¥é‡ç‚¹ä»‹ç»ä¸‹ module ä¸­çš„ä¸€äº›å±æ€§ï¼š</p><ul><li><p>exportsï¼šè¿™å°±æ˜¯ module.exports å¯¹åº”çš„å€¼ï¼Œç”±äºè¿˜æ²¡æœ‰èµ‹ä»»ä½•å€¼ç»™å®ƒï¼Œå®ƒç›®å‰æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ã€‚</p></li><li><p>loadedï¼šè¡¨ç¤ºå½“å‰çš„æ¨¡å—æ˜¯å¦åŠ è½½å®Œæˆã€‚</p></li><li><p>pathsï¼šnode æ¨¡å—çš„åŠ è½½è·¯å¾„ï¼Œè¿™å—ä¸å±•å¼€è®²ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹ node æ–‡æ¡£</p></li></ul><p>require å‡½æ•°ä¸­ä¹Ÿæœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„å±æ€§ï¼š</p><ul><li><p>main æŒ‡å‘å½“å‰å½“å‰å¼•ç”¨è‡ªå·±çš„æ¨¡å—ï¼Œæ‰€ä»¥ç±»ä¼¼ python çš„ <strong>name</strong> == &#39;<strong>main</strong>&#39;, node ä¹Ÿå¯ä»¥ç”¨ require.main === module æ¥ç¡®å®šæ˜¯å¦æ˜¯ä»¥å½“å‰æ¨¡å—æ¥å¯åŠ¨ç¨‹åºçš„ã€‚</p></li><li><p>extensions è¡¨ç¤ºç›®å‰ node æ”¯æŒçš„å‡ ç§åŠ è½½æ¨¡å—çš„æ–¹å¼ã€‚</p></li><li><p>cache è¡¨ç¤º node ä¸­æ¨¡å—åŠ è½½çš„ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªæ¨¡å—åŠ è½½ä¸€æ¬¡åï¼Œä¹‹å require ä¸ä¼šå†åŠ è½½ä¸€æ¬¡ï¼Œè€Œæ˜¯ä»ç¼“å­˜ä¸­è¯»å–ã€‚</p></li></ul><p>å‰é¢æåˆ°ï¼ŒCommonJS ä¸­ module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ require æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è€Œä¸æ­¤ç›¸å¯¹åº”çš„ ESM ä¸­çš„ import å’Œ export åˆ™æ˜¯å…³é”®å­—ï¼Œæ˜¯ ECMAScript æ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚ç†è§£è¿™ä¸¤è€…çš„åŒºåˆ«éå¸¸å…³é”®ã€‚</p><h2 id="å‡ ä¸ª-commonjs-ä¾‹å­" tabindex="-1">å‡ ä¸ª CommonJS ä¾‹å­ <a class="header-anchor" href="#å‡ ä¸ª-commonjs-ä¾‹å­" aria-hidden="true">#</a></h2><h3 id="åœ¨æ¨¡å—å¤–ä¸ºç®€å•ç±»å‹èµ‹å€¼" tabindex="-1">åœ¨æ¨¡å—å¤–ä¸ºç®€å•ç±»å‹èµ‹å€¼ï¼š <a class="header-anchor" href="#åœ¨æ¨¡å—å¤–ä¸ºç®€å•ç±»å‹èµ‹å€¼" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// a.js</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setVal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newVal</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  val</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  setVal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// b.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> val</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> setVal </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(val)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setVal</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">101</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(val)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>è¿è¡Œ b.jsï¼Œè¾“å‡ºç»“æœä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="åœ¨æ¨¡å—å¤–ä¸ºå¼•ç”¨ç±»å‹èµ‹å€¼" tabindex="-1">åœ¨æ¨¡å—å¤–ä¸ºå¼•ç”¨ç±»å‹èµ‹å€¼ï¼š <a class="header-anchor" href="#åœ¨æ¨¡å—å¤–ä¸ºå¼•ç”¨ç±»å‹èµ‹å€¼" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// a.js</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setVal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newVal</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  obj</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  setVal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// b.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> obj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> setVal </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(obj)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setVal</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">101</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(obj)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>è¿è¡Œ b.jsï¼Œè¾“å‡ºç»“æœä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="åœ¨æ¨¡å—å†…å¯¼å‡ºåæ”¹å˜ç®€å•ç±»å‹" tabindex="-1">åœ¨æ¨¡å—å†…å¯¼å‡ºåæ”¹å˜ç®€å•ç±»å‹ï¼š <a class="header-anchor" href="#åœ¨æ¨¡å—å†…å¯¼å‡ºåæ”¹å˜ç®€å•ç±»å‹" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// a.js</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  val</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// b.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(val)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>è¿è¡Œ b.jsï¼Œè¾“å‡ºç»“æœä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨-module-exports-å†å¯¼å‡ºä¸€æ¬¡" tabindex="-1">åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨ module.exports å†å¯¼å‡ºä¸€æ¬¡ï¼š <a class="header-anchor" href="#åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨-module-exports-å†å¯¼å‡ºä¸€æ¬¡" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// a.js</span></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// b.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(a)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>è¿è¡Œ b.jsï¼Œè¾“å‡ºç»“æœä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨-exports-å†å¯¼å‡ºä¸€æ¬¡" tabindex="-1">åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨ exports å†å¯¼å‡ºä¸€æ¬¡ï¼š <a class="header-anchor" href="#åœ¨æ¨¡å—å†…å¯¼å‡ºåç”¨-exports-å†å¯¼å‡ºä¸€æ¬¡" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// a.js</span></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.exports.</span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports.</span><span style="color:#A6ACCD;">val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// b.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(a)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>è¿è¡Œ b.js,è¾“å‡ºç»“æœä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="å°è¯•åˆ†æä¸€æ³¢" tabindex="-1">å°è¯•åˆ†æä¸€æ³¢ <a class="header-anchor" href="#å°è¯•åˆ†æä¸€æ³¢" aria-hidden="true">#</a></h2><p>åœ¨ç¬¬ä¸€ä¸ªä¸­ï¼Œä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CModule </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setVal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newVal</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  val</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  setVal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> useVal</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">setVal</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> useSetVal </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(useVal)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">useSetVal</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">101</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(useVal)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>åœ¨ç¬¬äºŒä¸ªä¸­ï¼Œä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CModule </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setVal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newVal</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  obj</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  setVal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">obj</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> useObj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">setVal</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> useSetVal </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(useObj)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">useSetVal</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">101</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(useObj)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>åœ¨ç¬¬ä¸‰ä¸ªä¸­ï¼Œä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CModule </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  val</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> useVal </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(useVal)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">useVal</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>åœ¨ç¬¬å››ä¸ªä¸­ï¼Œä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CModule </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> useA </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(useA)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">useA</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>åœ¨ç¬¬äº”ä¸ªä¸­ï¼Œä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CModule </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> useA </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(useA)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">useA</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>æˆ‘ä»¬è¿è¡Œä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œå‘ç°å’Œ CommonJS è¾“å‡ºçš„ç»“æœä¸€è‡´ã€‚æ‰€ä»¥ CommonJS ä¾æ—§æ˜¯æ—¥å¸¸å†™çš„æœ€ç®€å•çš„ JS ä»£ç ã€‚</p><p>å…¶å€¼æ‹·è´å‘ç”Ÿåœ¨ç»™ module.exports èµ‹å€¼çš„é‚£ä¸€åˆ»ï¼Œä¾‹å¦‚ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  val</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>ä½œç”¨æ˜¯ç»™ module.exports èµ‹äºˆäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªå¯¹è±¡é‡Œæœ‰ä¸€ä¸ª key å«åš valï¼Œè¿™ä¸ª val çš„å€¼æ˜¯å½“å‰æ¨¡å—ä¸­ val çš„å€¼ï¼Œä»…æ­¤è€Œå·²ã€‚</p><h2 id="commonjs-çš„å…·ä½“å®ç°" tabindex="-1">CommonJS çš„å…·ä½“å®ç° <a class="header-anchor" href="#commonjs-çš„å…·ä½“å®ç°" aria-hidden="true">#</a></h2><p>ä¸ºäº†æ›´é€å½»çš„äº†è§£ CommonJSï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªç®€å•çš„æ¨¡å—åŠ è½½å™¨ï¼Œä¸»è¦å‚è€ƒäº† nodejs æºç ï¼›</p><p>åœ¨ node v16.x ä¸­ module ä¸»è¦å®ç°åœ¨ lib/internal/modules/cjs/loader.js æ–‡ä»¶ä¸‹ã€‚</p><p>åœ¨ node v4.x ä¸­ module ä¸»è¦å®ç°åœ¨ lib/module.js æ–‡ä»¶ä¸‹ã€‚</p><p>ä¸‹é¢çš„å®ç°ä¸»è¦å‚è€ƒäº† node v4.x ä¸­çš„å®ç°ï¼Œå› ä¸ºè€ç‰ˆæœ¬ç›¸å¯¹æ›´â€œå¹²å‡€â€ä¸€äº›ï¼Œæ›´å®¹æ˜“æŠ“ä½ç»†èŠ‚ã€‚</p><p>å¦å¤– æ·±å…¥ Node.js çš„æ¨¡å—åŠ è½½æœºåˆ¶ï¼Œæ‰‹å†™ require å‡½æ•° è¿™ç¯‡æ–‡ç« å†™çš„ä¹Ÿå¾ˆä¸é”™ï¼Œä¸‹é¢çš„å®ç°å¾ˆå¤šä¹Ÿå‚è€ƒäº†è¿™ç¯‡æ–‡ç« ã€‚</p><p>ä¸ºäº†è·Ÿå®˜æ–¹ Module åå­—åŒºåˆ†å¼€ï¼Œæˆ‘ä»¬è‡ªå·±çš„ç±»å‘½åä¸º CModuleï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CModule</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ¨¡å—è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{};</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å¯¼å‡ºçš„ä¸œè¥¿æ”¾è¿™é‡Œï¼Œåˆå§‹åŒ–ä¸ºç©ºå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">loaded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç”¨æ¥æ ‡è¯†å½“å‰æ¨¡å—æ˜¯å¦å·²ç»åŠ è½½</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="require-æ–¹æ³•" tabindex="-1">require æ–¹æ³• <a class="header-anchor" href="#require-æ–¹æ³•" aria-hidden="true">#</a></h3><p>æˆ‘ä»¬ä¸€ç›´ç”¨çš„ require å…¶å®æ˜¯ Module ç±»çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå†…å®¹å¾ˆç®€å•ï¼Œå…ˆåšä¸€äº›å‚æ•°æ£€æŸ¥ï¼Œç„¶åè°ƒç”¨ Module.load æ–¹æ³•ï¼Œæºç åœ¨è¿™é‡Œï¼Œæœ¬ç¤ºä¾‹ä¸ºäº†ç®€æ´ï¼Œå»æ‰äº†ä¸€äº›åˆ¤æ–­ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_load</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>require æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œä¸»è¦æ˜¯åŒ…è£…äº† load è¿™ä¸ªå‡½æ•°ï¼Œä¸»è¦ä½œç”¨æ˜¯ï¼š</p><ul><li><p>å…ˆæ£€æŸ¥è¯·æ±‚çš„æ¨¡å—åœ¨ç¼“å­˜ä¸­æ˜¯å¦å·²ç»å­˜åœ¨äº†ï¼Œå¦‚æœå­˜åœ¨äº†ç›´æ¥è¿”å›ç¼“å­˜æ¨¡å—çš„ exports</p></li><li><p>å¦‚æœä¸åœ¨ç¼“å­˜ä¸­ï¼Œå°±åˆ›å»ºä¸€ä¸ª Module å®ä¾‹ï¼Œå°†è¯¥å®ä¾‹æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œç”¨è¿™ä¸ªå®ä¾‹åŠ è½½å¯¹åº”çš„æ¨¡å—ï¼Œå¹¶è¿”å›æ¨¡å—çš„ exports</p></li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// requestæ˜¯ä¼ å…¥çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_resolveFilename</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å…ˆæ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å­˜åœ¨ä¸”å·²ç»åŠ è½½ï¼Œç›´æ¥è¿”å›ç¼“å­˜</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±åŠ è½½è¿™ä¸ªæ¨¡å—</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">constmodule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">newCModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// loadä¹‹å‰å°±å°†è¿™ä¸ªæ¨¡å—ç¼“å­˜ä¸‹æ¥ï¼Œè¿™æ ·å¦‚æœæœ‰å¾ªç¯å¼•ç”¨å°±ä¼šæ‹¿åˆ°è¿™ä¸ªç¼“å­˜ï¼Œä½†æ˜¯è¿™ä¸ªç¼“å­˜é‡Œé¢çš„exportså¯èƒ½è¿˜æ²¡æœ‰æˆ–è€…ä¸å®Œæ•´</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦‚æœ load å¤±è´¥ï¼Œéœ€è¦å°† _cache ä¸­ç›¸åº”çš„ç¼“å­˜åˆ æ‰ã€‚è¿™é‡Œç®€å•èµ·è§ï¼Œä¸åšè¿™ä¸ªå¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.</span><span style="color:#82AAFF;">load</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">returnmodule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ä¸Šè¿°æºç è¿˜è°ƒç”¨äº†ä¸¤ä¸ªæ–¹æ³•ï¼šCModule.resolveFilename å’Œ CModule.prototype.loadï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><h3 id="cmodule-resolvefilename" tabindex="-1">CModule.resolveFilename <a class="header-anchor" href="#cmodule-resolvefilename" aria-hidden="true">#</a></h3><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡ç”¨æˆ·ä¼ å…¥çš„ require å‚æ•°æ¥è§£æåˆ°çœŸæ­£çš„æ–‡ä»¶åœ°å€ï¼Œæºç ä¸­è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºä»–è¦æ”¯æŒå¤šç§å‚æ•°ï¼šå†…ç½®æ¨¡å—ï¼Œç›¸å¯¹è·¯å¾„ï¼Œç»å¯¹è·¯å¾„ï¼Œæ–‡ä»¶å¤¹å’Œç¬¬ä¸‰æ–¹æ¨¡å—ç­‰ç­‰ã€‚</p><p>æœ¬ç¤ºä¾‹ä¸ºäº†ç®€æ´ï¼Œåªå®ç°ç›¸å¯¹æ–‡ä»¶çš„å¯¼å…¥ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_resolveFilename</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">returnpath</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><h3 id="cmodule-prototype-load" tabindex="-1">CModule.prototype.load <a class="header-anchor" href="#cmodule-prototype-load" aria-hidden="true">#</a></h3><p>CModule.prototype.load æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œæºä»£ç åœ¨è¿™é‡Œï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯çœŸæ­£ç”¨æ¥åŠ è½½æ¨¡å—çš„æ–¹æ³•ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸åŒç±»å‹æ–‡ä»¶åŠ è½½çš„ä¸€ä¸ªå…¥å£ï¼Œä¸åŒç±»å‹çš„æ–‡ä»¶ä¼šå¯¹åº” CModule.extensions é‡Œé¢çš„ä¸€ä¸ªæ–¹æ³•ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–æ–‡ä»¶åç¼€å</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">extname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extname</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è°ƒç”¨åç¼€åå¯¹åº”çš„å¤„ç†å‡½æ•°æ¥å¤„ç†ï¼Œå½“å‰å®ç°åªæ”¯æŒ JS</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_extensions</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">extname</span><span style="color:#F07178;">](</span><span style="color:#89DDFF;">this,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">loaded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><h3 id="åŠ è½½æ–‡ä»¶-cmodule-extensions-x" tabindex="-1">åŠ è½½æ–‡ä»¶: CModule.extensions[&#39;X&#39;] <a class="header-anchor" href="#åŠ è½½æ–‡ä»¶-cmodule-extensions-x" aria-hidden="true">#</a></h3><p>å‰é¢æåˆ°ä¸åŒæ–‡ä»¶ç±»å‹çš„å¤„ç†æ–¹æ³•éƒ½æŒ‚è½½åœ¨ CModule.extensions ä¸Šï¼Œäº‹å®ä¸Š node çš„åŠ è½½å™¨ä¸ä»…ä»…å¯ä»¥åŠ è½½ .js æ¨¡å—ï¼Œä¹Ÿå¯ä»¥åŠ è½½ .json å’Œ .node æ¨¡å—ã€‚æœ¬ç¤ºä¾‹ç®€å•èµ·è§ä»…å®ç° .js ç±»å‹æ–‡ä»¶çš„åŠ è½½ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_extensions[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.</span><span style="color:#82AAFF;">_compile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ° js çš„åŠ è½½æ–¹æ³•å¾ˆç®€å•ï¼Œåªæ˜¯æŠŠæ–‡ä»¶å†…å®¹è¯»å‡ºæ¥ï¼Œç„¶åè°ƒäº†å¦å¤–ä¸€ä¸ªå®ä¾‹æ–¹æ³• compile æ¥æ‰§è¡Œä»–ã€‚å¯¹åº”çš„æºç åœ¨è¿™é‡Œã€‚</p><h3 id="compile-å®ç°" tabindex="-1">compile å®ç° <a class="header-anchor" href="#compile-å®ç°" aria-hidden="true">#</a></h3><p>CModule.prototype.compile æ˜¯åŠ è½½ JS æ–‡ä»¶çš„æ ¸å¿ƒæ‰€åœ¨ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦å°†ç›®æ ‡æ–‡ä»¶æ‹¿å‡ºæ¥æ‰§è¡Œä¸€éã€‚å¯¹åº”çš„æºç åœ¨è¿™é‡Œã€‚</p><p>compile ä¸»è¦åšäº†å¦‚ä¸‹äº‹æƒ…ï¼š</p><p>1ã€æ‰§è¡Œä¹‹å‰éœ€è¦å°†å®ƒæ•´ä¸ªä»£ç åŒ…è£¹ä¸€å±‚ï¼Œä»¥ä¾¿æ³¨å…¥ exports, require, module, **dirname, **filenameï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬èƒ½åœ¨ JS æ–‡ä»¶é‡Œé¢ç›´æ¥ä½¿ç”¨è¿™å‡ ä¸ªå˜é‡çš„åŸå› ã€‚è¦å®ç°è¿™ç§æ³¨å…¥ä¹Ÿä¸éš¾ï¼Œå‡å¦‚æˆ‘ä»¬ require çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªç®€å•çš„ Hello Worldï¼Œé•¿è¿™æ ·ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>é‚£æˆ‘ä»¬æ€ä¹ˆæ¥ç»™ä»–æ³¨å…¥ module è¿™ä¸ªå˜é‡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ‰§è¡Œçš„æ—¶å€™åœ¨ä»–å¤–é¢å†åŠ ä¸€å±‚å‡½æ•°ï¼Œä½¿ä»–å˜æˆè¿™æ ·ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ³¨å…¥moduleå˜é‡ï¼Œå…¶å®å‡ ä¸ªå˜é‡åŒç†</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>nodeJS ä¹Ÿæ˜¯è¿™æ ·å®ç°çš„ï¼Œåœ¨ node æºç é‡Œï¼Œä¼šæœ‰è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">NativeModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wrap</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">script</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NativeModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">script</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NativeModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">NativeModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">(function (exports, require, module, __filename, __dirname) { </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">});</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>è¿™æ ·é€šè¿‡ CModule.wrap åŒ…è£…çš„ä»£ç å°±å¯ä»¥è·å–åˆ° exports, require, module, **filename, **dirname è¿™å‡ ä¸ªå˜é‡äº†ã€‚</p><p>2ã€æ”¾å…¥æ²™ç›’é‡Œæ‰§è¡ŒåŒ…è£…å¥½çš„ä»£ç ï¼Œå¹¶è¿”å›æ¨¡å—çš„ exportã€‚æ²™ç›’æ‰§è¡Œä½¿ç”¨äº† node çš„ vm æ¨¡å—ã€‚</p><p>åœ¨æœ¬å®ç°ä¸­ï¼Œcompile å®ç°å¦‚ä¸‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_compile</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">content</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–åŒ…è£…åå‡½æ•°ä½“</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">wrapper</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wrap</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// vmæ˜¯nodejsçš„è™šæ‹Ÿæœºæ²™ç›’æ¨¡å—ï¼ŒrunInThisContextæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶å°†å®ƒè½¬åŒ–ä¸ºä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è¿”å›å€¼å°±æ˜¯è½¬åŒ–åçš„å‡½æ•°ï¼Œæ‰€ä»¥compiledWrapperæ˜¯ä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">compiledWrapper</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">runInThisContext</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dirname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dirname</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">require</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dirname</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">compiledWrapper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>wrapper å’Œ warp çš„å®ç°å¦‚ä¸‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">(function (CExports, CRequire, CModule, __filename, __dirname) { </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">});</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wrap</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">script</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">script</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>æ³¨æ„ä¸Šé¢çš„ wrapper ä¸­æˆ‘ä»¬ä½¿ç”¨äº† CRequire å’Œ CModule æ¥åŒºåˆ†åŸç”Ÿçš„ require å’Œ module, ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä¼šä½¿ç”¨è‡ªå·±å®ç°çš„å‡½æ•°æ¥åŠ è½½æ–‡ä»¶ã€‚</p><h3 id="æœ€åç”Ÿæˆä¸€ä¸ªå®ä¾‹å¹¶å¯¼å‡º" tabindex="-1">æœ€åç”Ÿæˆä¸€ä¸ªå®ä¾‹å¹¶å¯¼å‡º <a class="header-anchor" href="#æœ€åç”Ÿæˆä¸€ä¸ªå®ä¾‹å¹¶å¯¼å‡º" aria-hidden="true">#</a></h3><p>æœ€åæˆ‘ä»¬ new ä¸€ä¸ª CModule çš„å®ç†å¹¶å¯¼å‡ºï¼Œæ–¹ä¾¿å¤–é¢ä½¿ç”¨ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CModuleInstance </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CModule</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CRequire </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModuleInstance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  CModule</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  CRequire</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><h3 id="å®Œæ•´ä»£ç " tabindex="-1">å®Œæ•´ä»£ç  <a class="header-anchor" href="#å®Œæ•´ä»£ç " aria-hidden="true">#</a></h3><p>æœ€åçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> vm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CModule</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ¨¡å—è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{};</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å¯¼å‡ºçš„ä¸œè¥¿æ”¾è¿™é‡Œï¼Œåˆå§‹åŒ–ä¸ºç©ºå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">loaded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç”¨æ¥æ ‡è¯†å½“å‰æ¨¡å—æ˜¯å¦å·²ç»åŠ è½½</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_cache </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_extensions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">(function (CExports, CRequire, CModule, __filename, __dirname) { </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">});</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wrap</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">script</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">script</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_load</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// requestæ˜¯ä¼ å…¥çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_resolveFilename</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å…ˆæ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å­˜åœ¨ä¸”å·²ç»åŠ è½½ï¼Œç›´æ¥è¿”å›ç¼“å­˜</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±åŠ è½½è¿™ä¸ªæ¨¡å—</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŠ è½½å‰å…ˆnewä¸€ä¸ªCModuleå®ä¾‹ï¼Œç„¶åè°ƒç”¨å®ä¾‹æ–¹æ³•loadæ¥åŠ è½½</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŠ è½½å®Œæˆç›´æ¥è¿”å›module.exports</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">CModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// loadä¹‹å‰å°±å°†è¿™ä¸ªæ¨¡å—ç¼“å­˜ä¸‹æ¥ï¼Œè¿™æ ·å¦‚æœæœ‰å¾ªç¯å¼•ç”¨å°±ä¼šæ‹¿åˆ°è¿™ä¸ªç¼“å­˜ï¼Œä½†æ˜¯è¿™ä¸ªç¼“å­˜é‡Œé¢çš„exportså¯èƒ½è¿˜æ²¡æœ‰æˆ–è€…ä¸å®Œæ•´</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦‚æœ load å¤±è´¥ï¼Œéœ€è¦å°† _cache ä¸­ç›¸åº”çš„ç¼“å­˜åˆ æ‰ã€‚è¿™é‡Œç®€å•èµ·è§ï¼Œä¸åšè¿™ä¸ªå¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.</span><span style="color:#82AAFF;">load</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_resolveFilename</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–æ–‡ä»¶åç¼€å</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">extname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extname</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è°ƒç”¨åç¼€åå¯¹åº”çš„å¤„ç†å‡½æ•°æ¥å¤„ç†ï¼Œå½“å‰å®ç°åªæ”¯æŒ JS</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_extensions</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">extname</span><span style="color:#F07178;">](</span><span style="color:#89DDFF;">this,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">loaded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_extensions[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">module.</span><span style="color:#82AAFF;">_compile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_compile</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">content</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–åŒ…è£…åå‡½æ•°ä½“</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">wrapper</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">wrap</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// vmæ˜¯nodejsçš„è™šæ‹Ÿæœºæ²™ç›’æ¨¡å—ï¼ŒrunInThisContextæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶å°†å®ƒè½¬åŒ–ä¸ºä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è¿”å›å€¼å°±æ˜¯è½¬åŒ–åçš„å‡½æ•°ï¼Œæ‰€ä»¥compiledWrapperæ˜¯ä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">compiledWrapper</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">runInThisContext</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">wrapper</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dirname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dirname</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">require</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dirname</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">compiledWrapper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CModuleInstance </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CModule</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CRequire </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CModuleInstance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  CModule</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  CRequire</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><h2 id="æºä»£ç ä¸­çš„-require-æ˜¯å¦‚ä½•å®ç°çš„" tabindex="-1">æºä»£ç ä¸­çš„ require æ˜¯å¦‚ä½•å®ç°çš„? <a class="header-anchor" href="#æºä»£ç ä¸­çš„-require-æ˜¯å¦‚ä½•å®ç°çš„" aria-hidden="true">#</a></h2><p>ç»†å¿ƒçš„ä½ å¯èƒ½ä¼šå‘ç°ï¼š nodejs v4.x æºç ä¸­å®ç° require çš„æ–‡ä»¶ lib/module.js ä¸­ï¼Œä¹Ÿä½¿ç”¨åˆ°äº† require å‡½æ•°ã€‚</p><p>è¿™ä¼¼ä¹äº§ç”Ÿæ˜¯å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„æ‚–è®ºï¼Œæˆ‘è¿˜æ²¡æŠŠä½ é€ å‡ºæ¥ï¼Œä½ æ€ä¹ˆå°±ç”¨èµ·æ¥äº†ï¼Ÿ</p><p>äº‹å®ä¸Šï¼Œæºç ä¸­çš„ require æœ‰å¦å¤–ç®€å•çš„å®ç°ï¼Œå®ƒè¢«å®šä¹‰åœ¨ src/node.js ä¸­ï¼Œæºç åœ¨è¿™é‡Œã€‚</p><h2 id="ç”¨è‡ªå®šä¹‰çš„-cmodule-æ¥åŠ è½½æ–‡ä»¶" tabindex="-1">ç”¨è‡ªå®šä¹‰çš„ CModule æ¥åŠ è½½æ–‡ä»¶ <a class="header-anchor" href="#ç”¨è‡ªå®šä¹‰çš„-cmodule-æ¥åŠ è½½æ–‡ä»¶" aria-hidden="true">#</a></h2><p>åˆšåˆšæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•çš„ Moduleï¼Œä½†æ˜¯èƒ½ä¸èƒ½æ­£å¸¸ç”¨è¿˜å­˜ç–‘ã€‚æ˜¯éª¡å­æ˜¯é©¬æ‹‰å‡ºæ¥é›é›ï¼Œæˆ‘ä»¬ç”¨è‡ªå·±çš„ CModule æ¥åŠ è½½æ–‡ä»¶ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</p><p>å¯ä»¥æŸ¥çœ‹ demos/01ï¼Œä»£ç çš„å…¥å£ä¸º app.js:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> CRequire </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./CModule.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">CRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./b.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>b.js çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> obj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> setVal </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(obj)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setVal</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">101</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(obj)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ç°åœ¨æˆ‘ä»¬ç”¨ CRequire å–ä»£ require æ¥åŠ è½½ ./a.js æ¨¡å—ã€‚</p><p>å†çœ‹çœ‹ ./a.js çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">val</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setVal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newVal</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  obj</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  setVal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ç°åœ¨æˆ‘ä»¬ç”¨ CModule å–ä»£ module æ¥å¯¼å‡ºæ¨¡å—ã€‚</p><p>æœ€åæ‰§è¡Œ node app.js æŸ¥çœ‹è¿è¡Œç»“æœï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">val</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">101</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆæ•ˆæœå’Œä½¿ç”¨åŸç”Ÿçš„ module æ¨¡å—ä¸€è‡´ã€‚</p><h2 id="ç”¨è‡ªå®šä¹‰çš„-cmodule-æ¥æµ‹è¯•å¾ªç¯å¼•ç”¨" tabindex="-1">ç”¨è‡ªå®šä¹‰çš„ CModule æ¥æµ‹è¯•å¾ªç¯å¼•ç”¨ <a class="header-anchor" href="#ç”¨è‡ªå®šä¹‰çš„-cmodule-æ¥æµ‹è¯•å¾ªç¯å¼•ç”¨" aria-hidden="true">#</a></h2><p>åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹åŸç”Ÿçš„ module æ¨¡å—çš„å¾ªç¯å¼•ç”¨ä¼šå‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ã€‚å¯ä»¥æŸ¥çœ‹ demos/02ï¼Œä»£ç çš„å…¥å£ä¸º app.jsï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>çœ‹çœ‹ ./a.js çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> setB </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./b.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">running a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">b val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> b)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">setB to bb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setB</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setA </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newA</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newA</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  a</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  setA</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å†çœ‹çœ‹ ./b.js çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> setA </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">running b.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> a)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">setA to aa</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setA</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">aa</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setB </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newB</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  b</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  setB</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ° ./a.js å’Œ ./b.js åœ¨æ–‡ä»¶çš„å¼€å¤´éƒ½ç›¸äº’å¼•ç”¨äº†å¯¹æ–¹ã€‚</p><p>æ‰§è¡Œ node app.js æŸ¥çœ‹è¿è¡Œç»“æœï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">running</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b.js</span></span>
<span class="line"><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">val</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">undefined</span></span>
<span class="line"><span style="color:#FFCB6B;">setA</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">aa</span></span>
<span class="line"><span style="color:#FFCB6B;">/demos/02/b.js:9</span></span>
<span class="line"><span style="color:#FFCB6B;">setA(&#39;aa&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">^</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">TypeError:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">setA</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">function</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">at</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Object.</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">anonymou</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">/demos/02/b.js:9:1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">at</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">xxx</span></span>
<span class="line"></span></code></pre></div><p>æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ª TypeError çš„å¼‚å¸¸æŠ¥é”™ï¼Œæç¤º setA is not a functionã€‚è¿™æ ·çš„å¼‚å¸¸åœ¨é¢„æœŸä¹‹å†…ï¼Œæˆ‘ä»¬å†è¯•è¯•è‡ªå·±å®ç°çš„ CModule çš„å¼‚å¸¸æ˜¯å¦å’ŒåŸç”Ÿ module çš„è¡Œä¸ºä¸€è‡´ã€‚</p><p>æˆ‘ä»¬æŸ¥çœ‹ demos/03ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨è‡ªå·±çš„ CModule æ¥å¤ç°ä¸Šé¢çš„å¾ªç¯å¼•ç”¨ï¼Œä»£ç çš„å…¥å£ä¸º app.jsï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> CRequire </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./CModule.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">CRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js çš„ä»£ç å¦‚ä¸‹ï¼š</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> setB </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./b.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">running a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b val</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> b)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setB to bb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setB</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setA </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newA</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newA</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    a</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    setA</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å†çœ‹çœ‹ ./b.js çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> setA </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">running b.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> a)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">setA to aa</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setA</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">aa</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setB </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newB</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  b</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  setB</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ç°åœ¨æˆ‘ä»¬ç”¨ CRequire å–ä»£äº† requireï¼Œç”¨ CModule å–ä»£äº† moduleã€‚</p><p>æœ€åæ‰§è¡Œ node app.js æŸ¥çœ‹è¿è¡Œç»“æœï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">running</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b.js</span></span>
<span class="line"><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">val</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">undefined</span></span>
<span class="line"><span style="color:#FFCB6B;">setA</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">aa</span></span>
<span class="line"><span style="color:#FFCB6B;">/demos/03/b.js:9</span></span>
<span class="line"><span style="color:#FFCB6B;">setA(&#39;aa&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">^</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">TypeError:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">setA</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">function</span></span>
<span class="line"><span style="color:#FFCB6B;">at</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Object.</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">anonymou</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">/demos/03/b.js:9:1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">at</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">xxx</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒCModule çš„è¡Œä¸ºå’ŒåŸç”Ÿ Module å¤„ç†å¾ªç¯å¼•ç”¨çš„å¼‚å¸¸æ˜¯ä¸€è‡´çš„ã€‚</p><h2 id="ä¸ºä»€ä¹ˆ-commonjs-ç›¸äº’å¼•ç”¨æ²¡æœ‰äº§ç”Ÿç±»ä¼¼-æ­»é”-çš„é—®é¢˜" tabindex="-1">ä¸ºä»€ä¹ˆ CommonJS ç›¸äº’å¼•ç”¨æ²¡æœ‰äº§ç”Ÿç±»ä¼¼â€œæ­»é”â€çš„é—®é¢˜ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-commonjs-ç›¸äº’å¼•ç”¨æ²¡æœ‰äº§ç”Ÿç±»ä¼¼-æ­»é”-çš„é—®é¢˜" aria-hidden="true">#</a></h2><p>æˆ‘ä»¬å¯ä»¥å‘ç° CommonJS æ¨¡å—ç›¸äº’å¼•ç”¨æ—¶ï¼Œæ²¡æœ‰äº§ç”Ÿç±»ä¼¼æ­»é”çš„é—®é¢˜ã€‚å…³é”®åœ¨ Module.load å‡½æ•°é‡Œï¼Œå…·ä½“æºä»£ç åœ¨è¿™é‡Œã€‚Module.load å‡½æ•°ä¸»è¦åšäº†ä¸‹é¢è¿™äº›äº‹æƒ…ï¼š</p><ul><li><p>æ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å­˜åœ¨ä¸”å·²ç»åŠ è½½ï¼Œç›´æ¥è¿”å›ç¼“å­˜ï¼Œä¸åšä¸‹é¢çš„å¤„ç†</p></li><li><p>å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œæ–°å»ºä¸€ä¸ª Module å®ä¾‹</p></li><li><p>å°†è¿™ä¸ª Module å®ä¾‹æ”¾åˆ°ç¼“å­˜ä¸­</p></li><li><p>é€šè¿‡è¿™ä¸ª Module å®ä¾‹æ¥åŠ è½½æ–‡ä»¶</p></li><li><p>è¿”å›è¿™ä¸ª Module å®ä¾‹çš„ exports</p></li></ul><p>å…¶ä¸­çš„å…³é”®åœ¨ æ”¾åˆ°ç¼“å­˜ä¸­ ä¸ åŠ è½½æ–‡ä»¶ çš„é¡ºåºï¼Œåœ¨æˆ‘ä»¬çš„ CModule ä¸­ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸¤è¡Œä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_cache[filename] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">module;</span></span>
<span class="line"><span style="color:#89DDFF;">module.</span><span style="color:#82AAFF;">load</span><span style="color:#A6ACCD;">(filename)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>å›åˆ°ä¸Šé¢å¾ªç¯åŠ è½½çš„ä¾‹å­ä¸­ï¼Œè§£é‡Šä¸€ä¸‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><p>å½“ app.js åŠ è½½ a.js æ—¶ï¼ŒModule ä¼šæ£€æŸ¥ç¼“å­˜ä¸­æœ‰æ²¡æœ‰ a.jsï¼Œå‘ç°æ²¡æœ‰ï¼Œäºæ˜¯ new ä¸€ä¸ª a.js æ¨¡å—ï¼Œå¹¶å°†è¿™ä¸ªæ¨¡å—æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå†å»åŠ è½½ a.js æ–‡ä»¶æœ¬èº«ã€‚</p><p>åœ¨åŠ è½½ a.js æ–‡ä»¶æ—¶ï¼ŒModule å‘ç°ç¬¬ä¸€è¡Œæ˜¯åŠ è½½ b.jsï¼Œå®ƒä¼šæ£€æŸ¥ç¼“å­˜ä¸­æœ‰æ²¡æœ‰ b.jsï¼Œå‘ç°æ²¡æœ‰ï¼Œäºæ˜¯ new ä¸€ä¸ª b.js æ¨¡å—ï¼Œå¹¶å°†è¿™ä¸ªæ¨¡å—æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå†å»åŠ è½½ b.js æ–‡ä»¶æœ¬èº«ã€‚</p><p>åœ¨åŠ è½½ b.js æ–‡ä»¶æ—¶ï¼ŒModule å‘ç°ç¬¬ä¸€è¡Œæ˜¯åŠ è½½ a.jsï¼Œå®ƒä¼šæ£€æŸ¥ç¼“å­˜ä¸­æœ‰æ²¡æœ‰ a.jsï¼Œå‘ç°å­˜åœ¨ï¼Œäºæ˜¯ require å‡½æ•°è¿”å›äº†ç¼“å­˜ä¸­çš„ a.jsã€‚</p><p>ä½†æ˜¯å…¶å®è¿™ä¸ªæ—¶å€™ a.js æ ¹æœ¬è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œè¿˜æ²¡èµ°åˆ° module.exports é‚£ä¸€æ­¥ï¼Œæ‰€ä»¥ b.js ä¸­ require(&#39;./a.js&#39;) è¿”å›çš„åªæ˜¯ä¸€ä¸ªé»˜è®¤çš„ç©ºå¯¹è±¡ã€‚æ‰€ä»¥æœ€ç»ˆä¼šæŠ¥ setA is not a function çš„å¼‚å¸¸ã€‚</p><p>è¯´åˆ°è¿™é‡Œï¼Œé‚£å¦‚ä½•è®¾è®¡ä¼šå¯¼è‡´â€œæ­»é”â€å‘¢ï¼Ÿå…¶å®ä¹Ÿå¾ˆç®€å• â€”â€” å°† æ”¾åˆ°ç¼“å­˜ä¸­ ä¸ åŠ è½½æ–‡ä»¶ çš„æ‰§è¡Œé¡ºåºäº’æ¢ï¼Œåœ¨æˆ‘ä»¬çš„ CModule ä»£ç ä¸­ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·å†™ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">module.</span><span style="color:#82AAFF;">load</span><span style="color:#A6ACCD;">(filename)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">CModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_cache[filename] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">module;</span></span>
<span class="line"></span></code></pre></div><p>è¿™æ ·äº’æ¢ä¸€ä¸‹ï¼Œå†æ‰§è¡Œ demo03ï¼Œæˆ‘ä»¬å‘ç°å¼‚å¸¸å¦‚ä¸‹ï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">RangeError:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Maximum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">call</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stack</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">size</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exceeded</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">at</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">console.value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">node:internal/console/constructor:290:13</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">at</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">console.log</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">node:internal/console/constructor:360:26</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>æˆ‘ä»¬å‘ç°è¿™æ ·å†™ä¼šæ­»é”ï¼Œæœ€ç»ˆå¯¼è‡´ JS æŠ¥æ ˆæº¢å‡ºå¼‚å¸¸ã€‚</p><h2 id="javascript-çš„æ‰§è¡Œè¿‡ç¨‹" tabindex="-1">JavaScript çš„æ‰§è¡Œè¿‡ç¨‹ <a class="header-anchor" href="#javascript-çš„æ‰§è¡Œè¿‡ç¨‹" aria-hidden="true">#</a></h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦è®²è§£ ESM çš„æ¨¡å—å¯¼å…¥ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ ESM çš„æ¨¡å—å¯¼å…¥ï¼Œè¿™é‡Œéœ€è¦è¡¥å……ä¸€ä¸ªçŸ¥è¯†ç‚¹ â€”â€” JavaScript çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><p>JavaScript æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:</p><ul><li><p>ç¼–è¯‘é˜¶æ®µ</p></li><li><p>æ‰§è¡Œé˜¶æ®µ</p></li></ul><h3 id="ç¼–è¯‘é˜¶æ®µ" tabindex="-1">ç¼–è¯‘é˜¶æ®µ <a class="header-anchor" href="#ç¼–è¯‘é˜¶æ®µ" aria-hidden="true">#</a></h3><p>åœ¨ç¼–è¯‘é˜¶æ®µ JS å¼•æ“ä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼š</p><ul><li><p>è¯æ³•åˆ†æ</p></li><li><p>è¯­æ³•åˆ†æ</p></li><li><p>å­—èŠ‚ç ç”Ÿæˆ</p></li></ul><p>è¿™é‡Œä¸è¯¦æƒ…è®²è¿™ä¸‰ä»¶äº‹çš„å…·ä½“ç»†èŠ‚ï¼Œæ„Ÿå…´è¶£ä½ å¯ä»¥é˜…è¯» the-super-tiny-compiler è¿™ä¸ªä»“åº“ï¼Œå®ƒé€šè¿‡å‡ ç™¾è¡Œçš„ä»£ç å®ç°äº†ä¸€ä¸ªå¾®å½¢ç¼–è¯‘å™¨ï¼Œå¹¶è¯¦ç»†è®²äº†è¿™ä¸‰ä¸ªè¿‡ç¨‹çš„å…·ä½“ç»†èŠ‚ã€‚</p><h3 id="æ‰§è¡Œé˜¶æ®µ" tabindex="-1">æ‰§è¡Œé˜¶æ®µ <a class="header-anchor" href="#æ‰§è¡Œé˜¶æ®µ" aria-hidden="true">#</a></h3><p>åœ¨æ‰§è¡Œé˜¶æ®µï¼Œä¼šåˆ†æƒ…å†µåˆ›å»ºå„ç§ç±»å‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚ï¼šå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ (åªæœ‰ä¸€ä¸ª)ã€å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚è€Œæ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»ºåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li><p>åˆ›å»ºé˜¶æ®µ</p></li><li><p>æ‰§è¡Œé˜¶æ®µ</p></li></ul><p>åœ¨åˆ›å»ºé˜¶æ®µä¼šåšå¦‚ä¸‹äº‹æƒ…ï¼š</p><ul><li><p>ç»‘å®š this</p></li><li><p>ä¸ºå‡½æ•°å’Œå˜é‡åˆ†é…å†…å­˜ç©ºé—´</p></li><li><p>åˆå§‹åŒ–ç›¸å…³å˜é‡ä¸º undefined</p></li></ul><p>æˆ‘ä»¬æ—¥å¸¸æåˆ°çš„ å˜é‡æå‡ å’Œ å‡½æ•°æå‡ å°±æ˜¯åœ¨ åˆ›å»ºé˜¶æ®µ åšçš„ï¼Œæ‰€ä»¥ä¸‹é¢çš„å†™æ³•å¹¶ä¸ä¼šæŠ¥é”™ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(msg)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> msg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#82AAFF;">functionadd</span><span style="color:#A6ACCD;">(a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">b)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å› ä¸ºåœ¨æ‰§è¡Œä¹‹å‰çš„åˆ›å»ºé˜¶æ®µï¼Œå·²ç»åˆ†é…å¥½äº† msg å’Œ add çš„å†…å­˜ç©ºé—´ã€‚</p><h2 id="javascript-çš„å¸¸è§æŠ¥é”™ç±»å‹" tabindex="-1">JavaScript çš„å¸¸è§æŠ¥é”™ç±»å‹ <a class="header-anchor" href="#javascript-çš„å¸¸è§æŠ¥é”™ç±»å‹" aria-hidden="true">#</a></h2><p>ä¸ºäº†æ›´å®¹æ˜“ç†è§£ ESM çš„æ¨¡å—å¯¼å…¥ï¼Œè¿™é‡Œå†è¡¥å……ä¸€ä¸ªçŸ¥è¯†ç‚¹ â€”â€” JavaScript çš„å¸¸è§æŠ¥é”™ç±»å‹ã€‚</p><h3 id="_1ã€rangeerror" tabindex="-1">1ã€RangeError <a class="header-anchor" href="#_1ã€rangeerror" aria-hidden="true">#</a></h3><p>è¿™ç±»é”™è¯¯å¾ˆå¸¸è§ï¼Œä¾‹å¦‚æ ˆæº¢å‡ºå°±æ˜¯ RangeErrorï¼›</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">functiona</span><span style="color:#A6ACCD;"> () </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">b</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">functionb</span><span style="color:#A6ACCD;"> () </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">a</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">a</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// out:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// RangeError: Maximum call stack size exceeded</span></span>
<span class="line"></span></code></pre></div><h3 id="_2ã€referenceerror" tabindex="-1">2ã€ReferenceError <a class="header-anchor" href="#_2ã€referenceerror" aria-hidden="true">#</a></h3><p>ReferenceError ä¹Ÿå¾ˆå¸¸è§ï¼Œæ‰“å°ä¸€ä¸ªä¸å­˜åœ¨çš„å€¼å°±æ˜¯ ReferenceErrorï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">hello</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// out:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ReferenceError: hello is not defined</span></span>
<span class="line"></span></code></pre></div><h3 id="_3ã€syntaxerror" tabindex="-1">3ã€SyntaxError <a class="header-anchor" href="#_3ã€syntaxerror" aria-hidden="true">#</a></h3><p>SyntaxError ä¹Ÿå¾ˆå¸¸è§ï¼Œå½“è¯­æ³•ä¸ç¬¦åˆ JS è§„èŒƒæ—¶ï¼Œå°±ä¼šæŠ¥è¿™ç§é”™è¯¯ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// out:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// console.log(1));</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ^</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// SyntaxError: Unexpected token &#39;)&#39;</span></span>
<span class="line"></span></code></pre></div><h3 id="_4ã€typeerror" tabindex="-1">4ã€TypeError <a class="header-anchor" href="#_4ã€typeerror" aria-hidden="true">#</a></h3><p>TypeError ä¹Ÿå¾ˆå¸¸è§ï¼Œå½“ä¸€ä¸ªåŸºç¡€ç±»å‹å½“ä½œå‡½æ•°æ¥ç”¨æ—¶ï¼Œå°±ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">vara </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">a</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// out:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// TypeError: a is not a function</span></span>
<span class="line"></span></code></pre></div><p>ä¸Šé¢çš„å„ç§ Error ç±»å‹ä¸­ï¼ŒSyntaxError æœ€ä¸ºç‰¹æ®Šï¼Œå› ä¸ºå®ƒæ˜¯ ç¼–è¯‘é˜¶æ®µ æŠ›å‡ºæ¥çš„é”™è¯¯ï¼Œå¦‚æœå‘ç”Ÿè¯­æ³•é”™è¯¯ï¼ŒJS ä»£ç ä¸€è¡Œéƒ½ä¸ä¼šæ‰§è¡Œã€‚è€Œå…¶ä»–ç±»å‹çš„å¼‚å¸¸éƒ½æ˜¯ æ‰§è¡Œé˜¶æ®µ çš„é”™è¯¯ï¼Œå°±ç®—æŠ¥é”™ï¼Œä¹Ÿä¼šæ‰§è¡Œå¼‚å¸¸ä¹‹å‰çš„è„šæœ¬ã€‚</p><h2 id="ä»€ä¹ˆå«-ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£-ä»€ä¹ˆå«-è¿è¡Œæ—¶åŠ è½½" tabindex="-1">ä»€ä¹ˆå« ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£? ä»€ä¹ˆå« è¿è¡Œæ—¶åŠ è½½? <a class="header-anchor" href="#ä»€ä¹ˆå«-ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£-ä»€ä¹ˆå«-è¿è¡Œæ—¶åŠ è½½" aria-hidden="true">#</a></h2><p>ESM ä¹‹æ‰€ä»¥è¢«ç§°ä¸º ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ï¼Œæ˜¯å› ä¸ºå®ƒçš„æ¨¡å—è§£ææ˜¯å‘ç”Ÿåœ¨ ç¼–è¯‘é˜¶æ®µã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œimport å’Œ export è¿™äº›å…³é”®å­—æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå°±åšäº†æ¨¡å—è§£æï¼Œè¿™äº›å…³é”®å­—çš„ä½¿ç”¨å¦‚æœä¸ç¬¦åˆè¯­æ³•è§„èŒƒï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯ã€‚</p><p>ä¾‹å¦‚ï¼Œæ ¹æ® ES6 è§„èŒƒï¼Œimport åªèƒ½åœ¨æ¨¡å—é¡¶å±‚å£°æ˜ï¼Œæ‰€ä»¥ä¸‹é¢çš„å†™æ³•ä¼šç›´æ¥æŠ¥è¯­æ³•é”™è¯¯ï¼Œä¸ä¼šæœ‰ log æ‰“å°ï¼Œå› ä¸ºå®ƒå‹æ ¹å°±æ²¡æœ‰è¿›å…¥ æ‰§è¡Œé˜¶æ®µï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// out:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// import { resolve } from &#39;path&#39;;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ^</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// SyntaxError: Unexpected token &#39;{&#39;</span></span>
<span class="line"></span></code></pre></div><p>ä¸æ­¤å¯¹åº”çš„ CommonJSï¼Œå®ƒçš„æ¨¡å—è§£æå‘ç”Ÿåœ¨ æ‰§è¡Œé˜¶æ®µï¼Œå› ä¸º require å’Œ module æœ¬è´¨ä¸Šå°±æ˜¯ä¸ªå‡½æ•°æˆ–è€…å¯¹è±¡ï¼Œåªæœ‰åœ¨ æ‰§è¡Œé˜¶æ®µ è¿è¡Œæ—¶ï¼Œè¿™äº›å‡½æ•°æˆ–è€…å¯¹è±¡æ‰ä¼šè¢«å®ä¾‹åŒ–ã€‚å› æ­¤è¢«ç§°ä¸º è¿è¡Œæ—¶åŠ è½½ã€‚</p><p>è¿™é‡Œè¦ç‰¹åˆ«å¼ºè°ƒï¼Œä¸ CommonJS ä¸åŒï¼ŒESM ä¸­ import çš„ä¸æ˜¯å¯¹è±¡ï¼Œ export çš„ä¹Ÿä¸æ˜¯å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å†™æ³•ä¼šæç¤ºè¯­æ³•é”™è¯¯ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// è¯­æ³•é”™è¯¯ï¼è¿™ä¸æ˜¯è§£æ„ï¼ï¼ï¼</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">CA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./a.mjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¯­æ³•é”™è¯¯ï¼</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;">: &quot;</span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>import å’Œ export çš„ç”¨æ³•å¾ˆåƒå¯¼å…¥ä¸€ä¸ªå¯¹è±¡æˆ–è€…å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œä½†è¿™å’Œå¯¹è±¡å®Œå…¨æ²¡æœ‰å…³ç³»ã€‚ä»–ä»¬çš„ç”¨æ³•æ˜¯ ECMAScript è¯­è¨€å±‚é¢çš„è®¾è®¡çš„ï¼Œå¹¶ä¸”â€œæ°å·§â€çš„å¯¹è±¡çš„ä½¿ç”¨ç±»ä¼¼ã€‚</p><p>æ‰€ä»¥åœ¨ç¼–è¯‘é˜¶æ®µï¼Œimport æ¨¡å—ä¸­å¼•å…¥çš„å€¼å°±æŒ‡å‘äº† export ä¸­å¯¼å‡ºçš„å€¼ã€‚å¦‚æœäº†è§£ linuxï¼Œè¿™å°±æœ‰ç‚¹åƒ linux ä¸­çš„ç¡¬é“¾æ¥ï¼ŒæŒ‡å‘åŒä¸€ä¸ª inodeã€‚æˆ–è€…æ‹¿æ ˆå’Œå †æ¥æ¯”å–»ï¼Œè¿™å°±åƒä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘äº†åŒä¸€ä¸ªæ ˆã€‚</p><h2 id="esm-çš„åŠ è½½ç»†èŠ‚" tabindex="-1">ESM çš„åŠ è½½ç»†èŠ‚ <a class="header-anchor" href="#esm-çš„åŠ è½½ç»†èŠ‚" aria-hidden="true">#</a></h2><p>åœ¨è®²è§£ ESM çš„åŠ è½½ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬è¦äº†è§£ ESM ä¸­ä¹Ÿå­˜åœ¨ å˜é‡æå‡ å’Œ å‡½æ•°æå‡ ï¼Œæ„è¯†åˆ°è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</p><p>æ‹¿å‰é¢ demos/02 ä¸­æåˆ°çš„å¾ªç¯å¼•ç”¨ä¸¾ä¾‹å­ï¼Œå°†å…¶æ”¹é€ ä¸º ESM ç‰ˆçš„å¾ªç¯å¼•ç”¨ï¼ŒæŸ¥çœ‹ demos/04ï¼Œä»£ç çš„å…¥å£ä¸º app.jsï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.mjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>çœ‹çœ‹ ./a.mjs çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./b.mjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">running a.mjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">b val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> b)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">setB to bb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setB</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">constsetA</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newA</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newA</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å†çœ‹çœ‹ ./b.mjs çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./a.mjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">running b.mjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a val</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> a)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">setA to aa</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setA</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">aa</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">constsetB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newB</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ° ./a.mjs å’Œ ./b.mjs åœ¨æ–‡ä»¶çš„å¼€å¤´éƒ½ç›¸äº’å¼•ç”¨äº†å¯¹æ–¹ã€‚</p><p>æ‰§è¡Œ node app.mjs æŸ¥çœ‹è¿è¡Œç»“æœï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">running</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b.mjs</span></span>
<span class="line"><span style="color:#FFCB6B;">file:///demos/04/b.mjs:5</span></span>
<span class="line"><span style="color:#FFCB6B;">console.log(&#39;a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">val</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">, a);</span></span>
<span class="line"><span style="color:#C3E88D;">^</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">ReferenceError: Cannot access </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> before initialization</span></span>
<span class="line"><span style="color:#C3E88D;">at file:///demos/04/b.mjs:5:22</span></span>
<span class="line"></span></code></pre></div><p>æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ª ReferenceError çš„å¼‚å¸¸æŠ¥é”™ï¼Œæç¤ºä¸èƒ½åœ¨åˆå§‹åŒ–ä¹‹å‰ä½¿ç”¨å˜é‡ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† let å®šä¹‰å˜é‡ï¼Œä½¿ç”¨äº† const å®šä¹‰å‡½æ•°ï¼Œå¯¼è‡´æ— æ³•åšå˜é‡å’Œå‡½æ•°æå‡ã€‚</p><p>æ€ä¹ˆä¿®æ”¹æ‰èƒ½æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼šç”¨ var ä»£æ›¿ letï¼Œä½¿ç”¨ function æ¥å®šä¹‰å‡½æ•°ï¼Œæˆ‘ä»¬æŸ¥çœ‹ demos/05 æ¥çœ‹æ•ˆæœï¼š</p><p>çœ‹çœ‹ ./a.mjs çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b val</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> b)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setB to bb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setB</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">functionsetA</span><span style="color:#A6ACCD;">(newA) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newA</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">setA</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å†çœ‹çœ‹ ./b.mjs çš„ä»£ç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./a.mjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">running b.mjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a val</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> a)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setA to aa</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setA</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">aa</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">functionsetB</span><span style="color:#A6ACCD;">(newB) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newB</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">setB</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>æ‰§è¡Œ node app.mjs æŸ¥çœ‹è¿è¡Œç»“æœï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">running</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b.mjs</span></span>
<span class="line"><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">val</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">undefined</span></span>
<span class="line"><span style="color:#FFCB6B;">setA</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">aa</span></span>
<span class="line"><span style="color:#FFCB6B;">running</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a.mjs</span></span>
<span class="line"><span style="color:#FFCB6B;">b</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">val</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b</span></span>
<span class="line"><span style="color:#FFCB6B;">setB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bb</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥å‘ç°è¿™æ ·ä¿®æ”¹åå¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œæ²¡æœ‰å‡ºç°å¼‚å¸¸æŠ¥é”™ã€‚</p><p>å†™åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¯¦ç»†è°ˆè°ˆ ESM çš„åŠ è½½ç»†èŠ‚äº†ï¼Œå®ƒå…¶å®å’Œå‰é¢æåˆ°çš„ CommonJS çš„ Module.load å‡½æ•°åšçš„äº‹æƒ…æœ‰äº›ç±»ä¼¼ï¼š</p><ul><li><p>æ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å­˜åœ¨ä¸”å·²ç»åŠ è½½ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜æ¨¡å—ä¸­æå–ç›¸åº”çš„å€¼ï¼Œä¸åšä¸‹é¢çš„å¤„ç†</p></li><li><p>å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œæ–°å»ºä¸€ä¸ª Module å®ä¾‹</p></li><li><p>å°†è¿™ä¸ª Module å®ä¾‹æ”¾åˆ°ç¼“å­˜ä¸­</p></li><li><p>é€šè¿‡è¿™ä¸ª Module å®ä¾‹æ¥åŠ è½½æ–‡ä»¶</p></li><li><p>åŠ è½½æ–‡ä»¶ååˆ°å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œä¼šæœ‰åˆ›å»ºé˜¶æ®µå’Œæ‰§è¡Œé˜¶æ®µï¼Œåœ¨åˆ›å»ºé˜¶æ®µåšå‡½æ•°å’Œå˜é‡æå‡ï¼Œæ¥ç€æ‰§è¡Œä»£ç ã€‚</p></li><li><p>è¿”å›è¿™ä¸ª Module å®ä¾‹çš„ exports</p></li></ul><p>ç»“åˆ demos/05 çš„å¾ªç¯åŠ è½½ï¼Œæˆ‘ä»¬å†åšä¸€ä¸ªè¯¦ç»†çš„è§£é‡Šï¼š</p><p>å½“ app.mjs åŠ è½½ a.mjs æ—¶ï¼ŒModule ä¼šæ£€æŸ¥ç¼“å­˜ä¸­æœ‰æ²¡æœ‰ a.mjsï¼Œå‘ç°æ²¡æœ‰ï¼Œäºæ˜¯ new ä¸€ä¸ª a.mjs æ¨¡å—ï¼Œå¹¶å°†è¿™ä¸ªæ¨¡å—æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå†å»åŠ è½½ a.mjs æ–‡ä»¶æœ¬èº«ã€‚</p><p>åœ¨åŠ è½½ a.mjs æ–‡ä»¶æ—¶ï¼Œåœ¨ åˆ›å»ºé˜¶æ®µ ä¼šä¸ºå…¨å±€ä¸Šä¸‹æ–‡ä¸­çš„å‡½æ•° setA å’Œ å˜é‡ a åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶åˆå§‹åŒ–å˜é‡ a ä¸º undefinedã€‚åœ¨æ‰§è¡Œé˜¶æ®µï¼Œå‘ç°ç¬¬ä¸€è¡Œæ˜¯åŠ è½½ b.mjsï¼Œå®ƒä¼šæ£€æŸ¥ç¼“å­˜ä¸­æœ‰æ²¡æœ‰ b.mjsï¼Œå‘ç°æ²¡æœ‰ï¼Œäºæ˜¯ new ä¸€ä¸ª b.mjs æ¨¡å—ï¼Œå¹¶å°†è¿™ä¸ªæ¨¡å—æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå†å»åŠ è½½ b.mjs æ–‡ä»¶æœ¬èº«ã€‚</p><p>åœ¨åŠ è½½ b.mjs æ–‡ä»¶æ—¶ï¼Œåœ¨ åˆ›å»ºé˜¶æ®µ ä¼šä¸ºå…¨å±€ä¸Šä¸‹æ–‡ä¸­çš„å‡½æ•° setB å’Œ å˜é‡ b åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶åˆå§‹åŒ–å˜é‡ b ä¸º undefinedã€‚åœ¨æ‰§è¡Œé˜¶æ®µ,å‘ç°ç¬¬ä¸€è¡Œæ˜¯åŠ è½½ a.mjsï¼Œå®ƒä¼šæ£€æŸ¥ç¼“å­˜ä¸­æœ‰æ²¡æœ‰ a.mjsï¼Œå‘ç°å­˜åœ¨ï¼Œäºæ˜¯ import è¿”å›äº†ç¼“å­˜ä¸­ a.mjs å¯¼å‡ºçš„ç›¸åº”çš„å€¼ã€‚</p><p>è™½ç„¶è¿™ä¸ªæ—¶å€™ a.mjs æ ¹æœ¬è¿˜æ²¡æœ‰æ‰§è¡Œè¿‡ï¼Œä½†æ˜¯å®ƒçš„ åˆ›å»ºé˜¶æ®µ å·²ç»å®Œæˆäº†ï¼Œå³åœ¨å†…å­˜ä¸­ä¹Ÿå·²ç»å­˜åœ¨äº† setA å‡½æ•°å’Œå€¼ä¸º undefined çš„å˜é‡ aã€‚æ‰€ä»¥è¿™æ—¶å€™åœ¨ b.mjs é‡Œå¯ä»¥æ­£å¸¸æ‰“å° a å¹¶ä½¿ç”¨ setA å‡½æ•°è€Œæ²¡æœ‰å¼‚å¸¸æŠ›é”™ã€‚</p><h2 id="å†è°ˆ-esm-å’Œ-commonjs-çš„åŒºåˆ«" tabindex="-1">å†è°ˆ ESM å’Œ CommonJS çš„åŒºåˆ« <a class="header-anchor" href="#å†è°ˆ-esm-å’Œ-commonjs-çš„åŒºåˆ«" aria-hidden="true">#</a></h2><p><strong>ä¸åŒç‚¹ï¼šthis çš„æŒ‡å‘ä¸åŒ</strong></p><p>CommonJS çš„ this æŒ‡å‘å¯ä»¥æŸ¥çœ‹æºç ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> args </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> require</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> filename</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> dirname]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> compiledWrapper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#A6ACCD;">(self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> args)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>å¾ˆæ¸…æ¥šçš„å¯ä»¥çœ‹åˆ° this æŒ‡å‘çš„æ˜¯å½“å‰ module çš„é»˜è®¤ exportsï¼›</p><p>è€Œ ESM ç”±äºè¯­è¨€å±‚é¢çš„è®¾è®¡æŒ‡å‘çš„æ˜¯ undefinedã€‚</p><p><strong>ä¸åŒç‚¹ï¼šfilenameï¼Œdirname åœ¨ CommonJS ä¸­å­˜åœ¨ï¼Œåœ¨ ESM ä¸­ä¸å­˜åœ¨</strong></p><p>åœ¨ CommonJS ä¸­ï¼Œæ¨¡å—çš„æ‰§è¡Œéœ€è¦ç”¨å‡½æ•°åŒ…èµ·æ¥ï¼Œå¹¶æŒ‡å®šä¸€äº›å¸¸ç”¨çš„å€¼</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">NativeModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">wrapper </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">(function (exports, require, module, __filename, __dirname) { </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">});</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>æ‰€ä»¥æˆ‘ä»¬å…¨å±€æ‰å¯ä»¥ç›´æ¥ç”¨ **filenameã€**dirnameã€‚è€Œ ESM æ²¡æœ‰è¿™æ–¹é¢çš„è®¾è®¡ï¼Œæ‰€ä»¥åœ¨ ESM ä¸­ä¸èƒ½ç›´æ¥ä½¿ç”¨ **filename å’Œ **dirnameã€‚</p><p><strong>ç›¸åŒç‚¹ï¼šESM å’Œ CommonJS éƒ½æœ‰ç¼“å­˜</strong></p><p>è¿™ä¸€ç‚¹ä¸¤ç§æ¨¡å—æ–¹æ¡ˆä¸€è‡´ï¼Œéƒ½ä¼šç¼“å­˜æ¨¡å—ï¼Œæ¨¡å—åŠ è½½ä¸€æ¬¡åä¼šç¼“å­˜èµ·æ¥ï¼Œåç»­å†æ¬¡åŠ è½½ä¼šç”¨ç¼“å­˜é‡Œçš„æ¨¡å—ã€‚</p>`,232),e=[o];function t(c,r,D,y,F,C){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{i as __pageData,d as default};
